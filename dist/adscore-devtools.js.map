{
  "version": 3,
  "sources": ["../src/visualization/overlay.ts", "../src/reporting/summary.ts", "../src/reporting/consoleReporter.ts", "../src/measurement/selectors.ts", "../src/measurement/elementId.ts", "../src/measurement/adCollector.ts", "../src/measurement/scrollHarness.ts", "../src/config/defaultConfig.ts", "../src/metrics/adDensity.ts", "../src/runtime/runAudit.ts", "../src/devtools-entry.ts"],
  "sourcesContent": ["import type { AdSlotSample } from '../types/measurement.js';\n\nconst OVERLAY_ROOT_ID = '__ad_score_overlay_root__';\n\nexport interface OverlayOptions {\n  palette?: string[];\n  opacity?: number;\n  showLabels?: boolean;\n}\n\nconst DEFAULT_PALETTE = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728'];\nconst DEFAULT_OVERLAY_OPACITY = 0.4;\n\nfunction clamp(value: number, min: number, max: number): number {\n  return Math.min(Math.max(value, min), max);\n}\n\nfunction hexToRgb(color: string): { r: number; g: number; b: number } | null {\n  const normalized = color.replace('#', '');\n  if (normalized.length === 3) {\n    const rHex = normalized.charAt(0);\n    const gHex = normalized.charAt(1);\n    const bHex = normalized.charAt(2);\n    const r = parseInt(rHex + rHex, 16);\n    const g = parseInt(gHex + gHex, 16);\n    const b = parseInt(bHex + bHex, 16);\n    if (Number.isNaN(r) || Number.isNaN(g) || Number.isNaN(b)) {\n      return null;\n    }\n    return { r, g, b };\n  }\n\n  if (normalized.length === 6) {\n    const r = parseInt(normalized.slice(0, 2), 16);\n    const g = parseInt(normalized.slice(2, 4), 16);\n    const b = parseInt(normalized.slice(4, 6), 16);\n    if (Number.isNaN(r) || Number.isNaN(g) || Number.isNaN(b)) {\n      return null;\n    }\n    return { r, g, b };\n  }\n\n  return null;\n}\n\nfunction applyAlpha(color: string, alpha: number): string {\n  const clampedAlpha = clamp(alpha, 0, 1);\n\n  if (color.startsWith('rgba(')) {\n    return color.replace(/rgba\\(([^)]+)\\)/, (_match, components) => {\n      const parts = components.split(',').map((part: string) => part.trim());\n      const base = parts.slice(0, 3).join(', ');\n      return `rgba(${base}, ${clampedAlpha})`;\n    });\n  }\n\n  if (color.startsWith('rgb(')) {\n    return color.replace(/rgb\\(([^)]+)\\)/, (_match, components) => {\n      return `rgba(${components.trim()}, ${clampedAlpha})`;\n    });\n  }\n\n  if (color.startsWith('#')) {\n    const rgb = hexToRgb(color);\n    if (rgb) {\n      const { r, g, b } = rgb;\n      return `rgba(${r}, ${g}, ${b}, ${clampedAlpha})`;\n    }\n  }\n\n  return color;\n}\n\nfunction uniqueSlotsByElement(slots: AdSlotSample[]): AdSlotSample[] {\n  const seen = new Set<HTMLElement>();\n  const uniques: AdSlotSample[] = [];\n\n  slots.forEach((slot) => {\n    if (seen.has(slot.element)) {\n      return;\n    }\n    seen.add(slot.element);\n    uniques.push(slot);\n  });\n\n  return uniques;\n}\n\ntype OverlayState = {\n  root: HTMLElement;\n  slots: AdSlotSample[];\n  overlays: HTMLElement[];\n  rafId: number | null;\n  handleScroll: () => void;\n  handleResize: () => void;\n};\n\nlet activeState: OverlayState | null = null;\n\nfunction disposeActiveState(): void {\n  if (!activeState) {\n    return;\n  }\n\n  window.removeEventListener('scroll', activeState.handleScroll, true);\n  window.removeEventListener('resize', activeState.handleResize);\n  if (activeState.rafId !== null) {\n    cancelAnimationFrame(activeState.rafId);\n  }\n  activeState = null;\n}\n\nexport function clearAdOverlays(): void {\n  if (typeof document === 'undefined') {\n    return;\n  }\n  disposeActiveState();\n  const existing = document.getElementById(OVERLAY_ROOT_ID);\n  if (existing?.parentNode) {\n    existing.parentNode.removeChild(existing);\n  }\n}\n\nexport function renderAdOverlays(slots: AdSlotSample[], options: OverlayOptions = {}): void {\n  if (typeof document === 'undefined') {\n    return;\n  }\n\n  clearAdOverlays();\n\n  const uniqueSlots = uniqueSlotsByElement(slots);\n\n  if (uniqueSlots.length === 0) {\n    return;\n  }\n\n  const palette = options.palette ?? DEFAULT_PALETTE;\n  const opacity = options.opacity ?? DEFAULT_OVERLAY_OPACITY;\n  const showLabels = options.showLabels ?? true;\n\n  const root = document.createElement('div');\n  root.id = OVERLAY_ROOT_ID;\n  root.style.position = 'absolute';\n  root.style.top = '0';\n  root.style.left = '0';\n  root.style.width = '0';\n  root.style.height = '0';\n  root.style.pointerEvents = 'none';\n  root.style.zIndex = '2147483647';\n  root.style.fontFamily = 'system-ui, sans-serif';\n  document.body.appendChild(root);\n\n  const overlays: HTMLElement[] = [];\n\n  uniqueSlots.forEach((slot, index) => {\n    const color = palette[index % palette.length] ?? '#ff00ff';\n    const overlay = document.createElement('div');\n    overlay.style.position = 'absolute';\n    overlay.style.backgroundColor = applyAlpha(color, opacity);\n    overlay.style.border = `1px solid ${color}`;\n    overlay.style.boxSizing = 'border-box';\n    overlay.style.pointerEvents = 'none';\n\n    if (showLabels) {\n      const label = document.createElement('div');\n      label.style.position = 'absolute';\n      label.style.top = '50%';\n      label.style.left = '50%';\n      label.style.transform = 'translate(-50%, -50%)';\n      label.style.padding = '6px 10px';\n      label.style.background = '#111';\n      label.style.color = '#fff';\n      label.style.fontSize = '13px';\n      label.style.lineHeight = '1.35';\n      label.style.textAlign = 'center';\n      label.style.borderRadius = '6px';\n      label.style.pointerEvents = 'none';\n      label.style.boxShadow = '0 4px 16px rgba(0, 0, 0, 0.45)';\n      label.style.maxWidth = '260px';\n      label.style.whiteSpace = 'pre-line';\n      label.style.opacity = '1';\n\n      const coverage = (slot.coverageRatio * 100).toFixed(1);\n      label.textContent = `${slot.slotName ?? slot.logicalId}\\n${slot.provider} \u00B7 ${coverage}% viewport`;\n\n      overlay.appendChild(label);\n    }\n\n    root.appendChild(overlay);\n    overlays.push(overlay);\n  });\n\n  const state: OverlayState = {\n    root,\n    slots: uniqueSlots,\n    overlays,\n    rafId: null,\n    handleScroll: () => {},\n    handleResize: () => {}\n  };\n\n  state.handleScroll = () => scheduleUpdate(state);\n  state.handleResize = () => scheduleUpdate(state);\n\n  activeState = state;\n\n  window.addEventListener('scroll', state.handleScroll, true);\n  window.addEventListener('resize', state.handleResize);\n\n  updateOverlayPositions(state);\n}\n\nfunction updateOverlayPositions(state: OverlayState): void {\n  state.overlays.forEach((overlay, index) => {\n    const slot = state.slots[index];\n    if (!slot) {\n      overlay.style.display = 'none';\n      return;\n    }\n    const element = slot.element;\n\n    if (!element || typeof element.getBoundingClientRect !== 'function') {\n      overlay.style.display = 'none';\n      return;\n    }\n\n    const rect = element.getBoundingClientRect();\n\n    if (rect.width <= 0 || rect.height <= 0) {\n      overlay.style.display = 'none';\n      return;\n    }\n\n    overlay.style.display = 'block';\n    overlay.style.left = '0';\n    overlay.style.top = '0';\n    overlay.style.transform = `translate(${rect.left + window.scrollX}px, ${rect.top + window.scrollY}px)`;\n    overlay.style.width = `${rect.width}px`;\n    overlay.style.height = `${rect.height}px`;\n    overlay.style.transformOrigin = 'top left';\n  });\n}\n\nfunction scheduleUpdate(state: OverlayState): void {\n  if (state.rafId !== null) {\n    return;\n  }\n  state.rafId = requestAnimationFrame(() => {\n    state.rafId = null;\n    updateOverlayPositions(state);\n  });\n}\n", "import type { AdScoreReport, AdScoreSummary } from '../types/report.js';\n\nexport function buildReportSummary(report: AdScoreReport): AdScoreSummary {\n  const densityMetric = report.metrics.find(metric => metric.configId === 'adDensity');\n  const summary: AdScoreSummary = {\n    url: typeof window !== 'undefined' ? window.location.href : 'unknown',\n    timestamp: report.timestamp,\n    profileId: report.profile.id,\n    totalScore: report.totalScore,\n    sampleCount: report.measurement.samples.length,\n    uniqueAdSlots: countUniqueSlots(report)\n  };\n\n  if (densityMetric) {\n    const meta = densityMetric.result.meta as Record<string, unknown> | undefined;\n    const density: NonNullable<AdScoreSummary['density']> = {\n      raw: densityMetric.result.rawValue,\n      score: densityMetric.result.score\n    };\n\n    if (typeof meta?.stickyContributionArea === 'number') {\n      density.stickyContributionArea = meta.stickyContributionArea;\n    }\n    if (typeof meta?.stickySlotCount === 'number') {\n      density.stickySlotCount = meta.stickySlotCount;\n    }\n    if (typeof meta?.totalContentArea === 'number') {\n      density.totalContentArea = meta.totalContentArea;\n    }\n\n    summary.density = density;\n  }\n\n  return summary;\n}\n\nfunction countUniqueSlots(report: AdScoreReport): number {\n  const uniqueIds = new Set<string>();\n  for (const sample of report.measurement.samples) {\n    for (const slot of sample.adSlots) {\n      uniqueIds.add(`${slot.provider}::${slot.logicalId}`);\n    }\n  }\n  return uniqueIds.size;\n}\n", "import type { AdScoreReport } from '../types/report.js';\nimport { buildReportSummary } from './summary.js';\n\nfunction formatPercent(value: number, decimals = 1): string {\n  return `${(value * 100).toFixed(decimals)}%`;\n}\n\nfunction formatScore(value: number, decimals = 1): string {\n  return value.toFixed(decimals);\n}\n\nexport function renderConsoleReport(report: AdScoreReport): void {\n  const total = report.totalScore.toFixed(1);\n  const header = `AdScore: ${total} / 100 (metrics: ${report.metrics.length})`;\n\n  console.groupCollapsed(header);\n  console.log('Profile:', report.profile.label, `(${report.profile.id})`);\n  console.log('Measured samples:', report.measurement.samples.length);\n  console.log('Selectors used:', report.config.selectors.join(', '));\n\n  const summary = buildReportSummary(report);\n  console.log('Summary:', {\n    url: summary.url,\n    score: `${summary.totalScore.toFixed(1)}`,\n    samples: summary.sampleCount,\n    uniqueSlots: summary.uniqueAdSlots,\n    densityRaw: summary.density ? formatPercent(summary.density.raw) : 'n/a',\n    stickySlots: summary.density?.stickySlotCount ?? 0\n  });\n\n  const tableData = report.metrics.map(metric => ({\n    metric: metric.configId,\n    score: formatScore(metric.result.score),\n    weight: metric.weight.toFixed(2),\n    weightedScore: formatScore(metric.weightedScore),\n    raw: formatPercent(metric.result.rawValue)\n  }));\n\n  if (tableData.length > 0) {\n    console.table(tableData);\n  } else {\n    console.log('No active metrics computed. Check configuration.');\n  }\n\n  console.log('Totals:', {\n    totalWeightedScore: report.totalWeightedScore.toFixed(2),\n    totalWeightedMaxScore: report.totalWeightedMaxScore.toFixed(2),\n    totalScore: `${total}`\n  });\n\n  console.log('Export JSON:', JSON.stringify(summary));\n\n  console.groupEnd();\n}\n", "export const DEFAULT_AD_SELECTORS: string[] = [\n  'div[id*=\"div-gpt-ad-\"]',\n  '[data-google-query-id]',\n  '[class*=\"adnm-\"]'\n];\n\nexport const DATASET_ID_CANDIDATES: string[] = [\n  'googleAdId',\n  'googleQueryId',\n  'adId',\n  'adid',\n  'adUnit',\n  'adunit',\n  'adSlot',\n  'slotId',\n  'pbAdId',\n  'pbSlot',\n  'pbid',\n  'placementId',\n  'adnmFid'\n];\n\nexport const ATTRIBUTE_ID_CANDIDATES: string[] = [\n  'id',\n  'data-google-query-id',\n  'data-adslot',\n  'data-adunit',\n  'data-slot',\n  'data-adid',\n  'data-ad-name',\n  'data-adnm-fid',\n  'data-pb-slot',\n  'data-bidder',\n  'data-prebid'\n];\n", "const DATA_ATTRIBUTE_KEY = 'adsCoreId';\n\nfunction randomId(): string {\n  if (typeof crypto !== 'undefined' && 'randomUUID' in crypto) {\n    return crypto.randomUUID();\n  }\n  return 'ad_' + Math.random().toString(36).slice(2, 11);\n}\n\nexport function ensureElementId(element: HTMLElement): string {\n  const existing = element.dataset[DATA_ATTRIBUTE_KEY];\n  if (existing) {\n    return existing;\n  }\n  const id = randomId();\n  element.dataset[DATA_ATTRIBUTE_KEY] = id;\n  return id;\n}\n", "import { ATTRIBUTE_ID_CANDIDATES, DATASET_ID_CANDIDATES, DEFAULT_AD_SELECTORS } from './selectors.js';\nimport { ensureElementId } from './elementId.js';\nimport type { AdSlotSample, AdTechProvider, NormalizedRect, ScrollCaptureOptions } from '../types/measurement.js';\n\nconst VIEWPORT = () => ({\n  width: window.innerWidth,\n  height: window.innerHeight\n});\n\nfunction toNormalizedRect(rect: DOMRect): NormalizedRect {\n  return {\n    top: rect.top,\n    left: rect.left,\n    width: rect.width,\n    height: rect.height\n  };\n}\n\nfunction computeVisibleRect(rect: DOMRect, viewportWidth: number, viewportHeight: number): NormalizedRect {\n  const visibleTop = Math.max(rect.top, 0);\n  const visibleLeft = Math.max(rect.left, 0);\n  const visibleRight = Math.min(rect.right, viewportWidth);\n  const visibleBottom = Math.min(rect.bottom, viewportHeight);\n\n  const width = Math.max(0, visibleRight - visibleLeft);\n  const height = Math.max(0, visibleBottom - visibleTop);\n\n  return {\n    top: width > 0 && height > 0 ? visibleTop : 0,\n    left: width > 0 && height > 0 ? visibleLeft : 0,\n    width,\n    height\n  };\n}\n\nfunction hasHighImpactDataset(element: HTMLElement): boolean {\n  const dataset = element.dataset;\n  return (\n    !!dataset.adnmFid ||\n    !!dataset.adnmSid ||\n    !!dataset.adnmCc ||\n    !!dataset.adnmChannel ||\n    !!dataset.gumgum ||\n    !!dataset.highimpact ||\n    !!dataset.hiad\n  );\n}\n\nconst HIGH_IMPACT_CLASS_TOKENS = ['adnm-', 'adsm-', 'gumgum', 'highimpact', 'hiad'];\n\nfunction hasHighImpactClass(element: HTMLElement): boolean {\n  return Array.from(element.classList.values()).some(cls =>\n    HIGH_IMPACT_CLASS_TOKENS.some(token => cls.toLowerCase().includes(token))\n  );\n}\n\nfunction inferProvider(element: HTMLElement): AdTechProvider {\n  const id = element.id || '';\n  const classList = Array.from(element.classList.values()).join(' ');\n  const dataset = element.dataset;\n  const src = (element as HTMLIFrameElement).src ?? '';\n\n  if (id.startsWith('div-gpt-ad') || id.includes('google_ads_iframe') || dataset.googleQueryId || src.includes('/gampad/')) {\n    return 'gpt';\n  }\n\n  if ('adnmFid' in dataset || dataset.adnmFid || hasHighImpactDataset(element) || hasHighImpactClass(element)) {\n    return 'adnami';\n  }\n\n  if (\n    dataset.prebid !== undefined ||\n    dataset.pbSlot !== undefined ||\n    dataset.pbadid !== undefined ||\n    dataset.ortb2 !== undefined ||\n    id.startsWith('pb-slot-') ||\n    classList.includes('prebid')\n  ) {\n    return 'prebid';\n  }\n\n  return 'generic';\n}\n\nfunction pickSlotName(element: HTMLElement): string | null {\n  const dataset = element.dataset;\n  for (const key of DATASET_ID_CANDIDATES) {\n    const value = dataset[key as keyof DOMStringMap];\n    if (value) {\n      return value;\n    }\n  }\n\n  for (const attr of ATTRIBUTE_ID_CANDIDATES) {\n    const value = element.getAttribute(attr);\n    if (value) {\n      return value;\n    }\n  }\n\n  if (element.id) {\n    return element.id;\n  }\n\n  return null;\n}\n\nfunction isElementVisible(element: HTMLElement, rect: DOMRect): boolean {\n  const style = window.getComputedStyle(element);\n  if (style.display === 'none' || style.visibility === 'hidden' || Number.parseFloat(style.opacity) === 0) {\n    return false;\n  }\n  return rect.bottom > 0 && rect.top < window.innerHeight && rect.right > 0 && rect.left < window.innerWidth;\n}\n\nfunction detectSticky(element: HTMLElement, includeSticky: boolean): boolean {\n  if (!includeSticky) {\n    return false;\n  }\n  const style = window.getComputedStyle(element);\n  if (style.position === 'fixed' || style.position === 'sticky') {\n    return true;\n  }\n  const parent = element.closest('[style*=\"position:fixed\"], [style*=\"position: sticky\"]');\n  if (parent) {\n    return true;\n  }\n\n  const dataset = element.dataset;\n  const manualPlacement = dataset.manualPlacementGroup ?? dataset.adPositionName ?? '';\n  if (manualPlacement.toLowerCase().includes('sticky')) {\n    return true;\n  }\n\n  const fid = dataset.adnmFid ?? '';\n  if (fid) {\n    const lower = fid.toLowerCase();\n    if (lower.includes('skin') || lower.includes('topscroll') || lower.includes('canvas')) {\n      return true;\n    }\n  }\n\n  if (hasHighImpactDataset(element) || hasHighImpactClass(element)) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction uniqueElements(elements: HTMLElement[]): HTMLElement[] {\n  const seen = new Set<HTMLElement>();\n  const result: HTMLElement[] = [];\n  for (const el of elements) {\n    if (seen.has(el)) {\n      continue;\n    }\n    seen.add(el);\n    result.push(el);\n  }\n  return result;\n}\n\nconst IFRAMES_PREFERRING_SELECTORS = [\n  'iframe[id^=\"google_ads_iframe\"]',\n  'iframe[data-adnm-channel]',\n  'iframe[src*=\"adnami\"]',\n  'iframe[src*=\"gumgum\"]',\n  'iframe[src*=\"highimpact\"]',\n  'iframe[src*=\"adform\"]'\n].join(', ');\n\nfunction pickDominantDescendant(element: HTMLElement, elementArea: number): HTMLElement | null {\n  const candidates = Array.from(element.querySelectorAll<HTMLElement>(IFRAMES_PREFERRING_SELECTORS));\n  let best: HTMLElement | null = null;\n  let bestArea = 0;\n\n  for (const candidate of candidates) {\n    const rect = candidate.getBoundingClientRect();\n    const area = rect.width * rect.height;\n    if (area > bestArea) {\n      best = candidate;\n      bestArea = area;\n    }\n  }\n\n  if (!best) {\n    return null;\n  }\n\n  if (elementArea <= 0) {\n    return best;\n  }\n\n  const areaRatio = bestArea / elementArea;\n  if (areaRatio >= 0.8 || elementArea < 500) {\n    return best;\n  }\n\n  return null;\n}\n\nfunction resolveMeasurableElement(candidate: HTMLElement): HTMLElement | null {\n  if (!candidate.isConnected) {\n    return null;\n  }\n\n  if (candidate.tagName === 'IFRAME') {\n    return candidate;\n  }\n\n  if (hasHighImpactDataset(candidate) || hasHighImpactClass(candidate)) {\n    return candidate;\n  }\n\n  const rect = candidate.getBoundingClientRect();\n  const area = rect.width * rect.height;\n\n  const dominantDescendant = pickDominantDescendant(candidate, area);\n  if (dominantDescendant) {\n    return dominantDescendant;\n  }\n\n  return candidate;\n}\n\nfunction deriveLogicalId(element: HTMLElement, slotName: string | null): string {\n  const dataset = element.dataset;\n  const candidates = [\n    dataset.googleAdId,\n    dataset.googleQueryId,\n    dataset.adUnit,\n    dataset.adunit,\n    dataset.adSlot,\n    dataset.adslot,\n    dataset.slotId,\n    dataset.googleContainerId,\n    dataset.pbAdId,\n    dataset.adnmSid,\n    dataset.adnmFid,\n    dataset.adnmChannel,\n    dataset.adsCoreId,\n    slotName,\n    element.id\n  ];\n\n  const logical = candidates.find(value => typeof value === 'string' && value.trim().length > 0);\n  return logical ?? ensureElementId(element);\n}\n\nfunction filterHighImpactWrappers(samples: AdSlotSample[], viewportArea: number): AdSlotSample[] {\n  const groups = new Map<string, AdSlotSample[]>();\n\n  for (const sample of samples) {\n    if (sample.provider !== 'adnami') {\n      continue;\n    }\n    const dataset = sample.dataset;\n    const groupKey = dataset.adnmSid ?? dataset.adnmFid ?? dataset.adnmChannel;\n    if (!groupKey) {\n      continue;\n    }\n    const group = groups.get(groupKey) ?? [];\n    group.push(sample);\n    groups.set(groupKey, group);\n  }\n\n  const toOmit = new Set<AdSlotSample>();\n\n  for (const group of groups.values()) {\n    if (group.length <= 1) {\n      continue;\n    }\n\n    const threshold = viewportArea * 0.9;\n    const largeSurfaces = group.filter(sample => sample.visibleArea >= threshold);\n    const smallerSurfaces = group.filter(sample => sample.visibleArea > 0 && sample.visibleArea < threshold);\n\n    if (largeSurfaces.length > 0 && smallerSurfaces.length > 0) {\n      for (const sample of largeSurfaces) {\n        toOmit.add(sample);\n      }\n      continue;\n    }\n\n    if (largeSurfaces.length > 1) {\n      const sorted = [...largeSurfaces].sort((a, b) => b.visibleArea - a.visibleArea);\n      for (const sample of sorted.slice(1)) {\n        toOmit.add(sample);\n      }\n    }\n  }\n\n  if (toOmit.size === 0) {\n    return samples;\n  }\n\n  return samples.filter(sample => !toOmit.has(sample));\n}\n\nexport interface CollectAdSlotsOptions {\n  selectors?: string[];\n  includeStickyDetection?: boolean;\n}\n\nexport function collectAdSlotSamples(options: CollectAdSlotsOptions = {}): AdSlotSample[] {\n  const { selectors = DEFAULT_AD_SELECTORS, includeStickyDetection = true } = options;\n  const viewport = VIEWPORT();\n\n  const rawElements = selectors\n    .flatMap(selector => Array.from(document.querySelectorAll<HTMLElement>(selector)))\n    .filter(Boolean);\n\n  const normalizedElements = rawElements.map(resolveMeasurableElement).filter(Boolean) as HTMLElement[];\n\n  const uniqueCandidates = uniqueElements(normalizedElements);\n  const samples: AdSlotSample[] = [];\n\n  const preliminarySamples: AdSlotSample[] = [];\n\n  for (const element of uniqueCandidates) {\n    const rect = element.getBoundingClientRect();\n    const visibleRect = computeVisibleRect(rect, viewport.width, viewport.height);\n    const visibleArea = visibleRect.width * visibleRect.height;\n    const surfaceArea = rect.width * rect.height;\n    const isVisible = isElementVisible(element, rect) && visibleArea > 0;\n    const slotId = ensureElementId(element);\n    const slotName = pickSlotName(element);\n\n    const datasetRecord: Record<string, string> = {};\n    for (const [key, value] of Object.entries(element.dataset)) {\n      if (typeof value === 'string') {\n        datasetRecord[key] = value;\n      }\n    }\n\n    const logicalId = deriveLogicalId(element, slotName);\n    const provider = inferProvider(element);\n\n    if (\n      provider === 'adnami' &&\n      !datasetRecord.adnmFid &&\n      !datasetRecord.adnmSid &&\n      !datasetRecord.adnmChannel\n    ) {\n      continue;\n    }\n\n    preliminarySamples.push({\n      element,\n      id: slotId,\n      logicalId,\n      provider,\n      slotName,\n      dataset: datasetRecord,\n      boundingRect: toNormalizedRect(rect),\n      visibleRect,\n      surfaceArea,\n      visibleArea,\n      coverageRatio: viewport.width * viewport.height > 0 ? visibleArea / (viewport.width * viewport.height) : 0,\n      isVisible,\n      isSticky: detectSticky(element, includeStickyDetection)\n    });\n  }\n\n  const filteredSamples = filterHighImpactWrappers(preliminarySamples, viewport.width * viewport.height);\n\n  const visibleSamples = filteredSamples.filter(sample => sample.isVisible && sample.visibleArea > 0);\n\n  const deduped = new Map<string, AdSlotSample>();\n  for (const sample of visibleSamples) {\n    const key = `${sample.provider}::${sample.logicalId}`;\n    const existing = deduped.get(key);\n    if (!existing || sample.visibleArea > existing.visibleArea) {\n      deduped.set(key, sample);\n    }\n  }\n\n  return Array.from(deduped.values());\n}\n\nexport function getEffectiveSelectors(options?: ScrollCaptureOptions): string[] {\n  if (options?.selectors && options.selectors.length > 0) {\n    return options.selectors;\n  }\n  return DEFAULT_AD_SELECTORS;\n}\n", "import { collectAdSlotSamples, getEffectiveSelectors } from './adCollector.js';\nimport type { AdSlotSample, MeasurementRun, ScrollCaptureOptions, ViewportSample } from '../types/measurement.js';\nimport { renderAdOverlays, clearAdOverlays } from '../visualization/overlay.js';\n\nconst DEFAULT_DELAY_MS = 1500;\nconst MIN_DELAY_MS = 100;\nconst DEFAULT_SCROLL_STEP = () => window.innerHeight;\n\nfunction sleep(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, Math.max(ms, 0)));\n}\n\nfunction getDocumentHeight(): number {\n  return Math.max(\n    document.body?.scrollHeight ?? 0,\n    document.documentElement?.scrollHeight ?? 0,\n    document.body?.offsetHeight ?? 0,\n    document.documentElement?.offsetHeight ?? 0,\n    document.body?.clientHeight ?? 0,\n    document.documentElement?.clientHeight ?? 0\n  );\n}\n\nfunction isAtBottom(): boolean {\n  const scrollTop = window.scrollY || window.pageYOffset;\n  return scrollTop + window.innerHeight >= getDocumentHeight() - 2;\n}\n\ninterface SanitizedOptions {\n  delayMs: number;\n  scrollStepPx: number;\n  maxScrolls: number;\n  maxDurationMs: number;\n  includeStickyDetection: boolean;\n  debug: boolean;\n  respectShadowDom: boolean;\n  restoreScrollPosition: boolean;\n  visualizeDuringCapture: boolean;\n}\n\nfunction sanitizeOptions(options: ScrollCaptureOptions = {}): SanitizedOptions {\n  const delayMs = Math.max(options.delayMs ?? DEFAULT_DELAY_MS, MIN_DELAY_MS);\n  const scrollStepPx = options.scrollStepPx ?? DEFAULT_SCROLL_STEP();\n  const maxScrolls = options.maxScrolls ?? Number.POSITIVE_INFINITY;\n  const maxDurationMs = options.maxDurationMs ?? Number.POSITIVE_INFINITY;\n  const includeStickyDetection = options.includeStickyDetection ?? true;\n  const debug = options.debug ?? false;\n  const respectShadowDom = options.respectShadowDom ?? false;\n  const restoreScrollPosition = options.restoreScrollPosition ?? true;\n  const visualizeDuringCapture = options.visualizeDuringCapture ?? false;\n\n  return {\n    delayMs,\n    scrollStepPx: Math.max(scrollStepPx, 0),\n    maxScrolls,\n    maxDurationMs,\n    includeStickyDetection,\n    debug,\n    respectShadowDom,\n    restoreScrollPosition,\n    visualizeDuringCapture\n  };\n}\n\nfunction buildViewportSample(index: number, selectors: string[], includeStickyDetection: boolean): ViewportSample {\n  const viewportWidth = window.innerWidth;\n  const viewportHeight = window.innerHeight;\n  const viewportArea = viewportWidth * viewportHeight;\n\n  const adSlots = collectAdSlotSamples({\n    selectors,\n    includeStickyDetection\n  });\n  const totalVisibleAdArea = adSlots.reduce((sum, slot) => sum + slot.visibleArea, 0);\n  const totalAdArea = adSlots.reduce((sum, slot) => sum + slot.surfaceArea, 0);\n\n  return {\n    index,\n    timestamp: Date.now(),\n    scrollY: window.scrollY || window.pageYOffset,\n    viewport: {\n      width: viewportWidth,\n      height: viewportHeight\n    },\n    adSlots,\n    totalAdArea,\n    totalVisibleAdArea,\n    totalContentArea: viewportArea\n  };\n}\n\nexport async function captureViewportSamples(options: ScrollCaptureOptions = {}): Promise<MeasurementRun> {\n  const sanitized = sanitizeOptions(options);\n  const selectors = getEffectiveSelectors(options);\n\n  const originalScrollY = window.scrollY || window.pageYOffset;\n  const startedAt = Date.now();\n  const samples: ViewportSample[] = [];\n\n  let didSetCustomSelectors = false;\n  if (options?.selectors && options.selectors.length > 0) {\n    didSetCustomSelectors = true;\n  }\n\n  try {\n    let index = 0;\n    const startHighRes = typeof performance !== 'undefined' ? performance.now() : Date.now();\n\n    const aggregateSlots = new Map<string, AdSlotSample>();\n\n    const makeSlotKey = (slot: AdSlotSample) => `${slot.provider}::${slot.logicalId}`;\n\n    while (index < sanitized.maxScrolls) {\n      if (sanitized.debug) {\n        console.debug('[captureViewportSamples] Sampling viewport', { index, scrollY: window.scrollY });\n      }\n\n      const sample = buildViewportSample(index, selectors, sanitized.includeStickyDetection);\n      samples.push(sample);\n\n      if (sanitized.visualizeDuringCapture) {\n        for (const slot of sample.adSlots) {\n          aggregateSlots.set(makeSlotKey(slot), slot);\n        }\n        renderAdOverlays(Array.from(aggregateSlots.values()));\n      }\n\n      const elapsed = (typeof performance !== 'undefined' ? performance.now() : Date.now()) - startHighRes;\n      if (elapsed > sanitized.maxDurationMs) {\n        if (sanitized.debug) {\n          console.debug('[captureViewportSamples] Stopping due to maxDurationMs threshold');\n        }\n        break;\n      }\n\n      if (isAtBottom()) {\n        if (sanitized.debug) {\n          console.debug('[captureViewportSamples] Reached bottom of page');\n        }\n        break;\n      }\n\n      if (sanitized.scrollStepPx <= 0) {\n        if (sanitized.debug) {\n          console.debug('[captureViewportSamples] Non-positive scroll step; exiting loop');\n        }\n        break;\n      }\n\n      index += 1;\n      window.scrollBy({ top: sanitized.scrollStepPx, behavior: 'auto' });\n\n      if (sanitized.delayMs > 0) {\n        await sleep(sanitized.delayMs);\n      }\n    }\n  } finally {\n    if (sanitized.restoreScrollPosition) {\n      window.scrollTo({ top: originalScrollY, behavior: 'auto' });\n    }\n    if (sanitized.visualizeDuringCapture) {\n      clearAdOverlays();\n    }\n  }\n\n  const finishedAt = Date.now();\n\n  return {\n    samples,\n    metadata: {\n      startedAt,\n      finishedAt,\n      totalDurationMs: finishedAt - startedAt,\n      initialScrollY: originalScrollY,\n      finalScrollY: window.scrollY || window.pageYOffset,\n      scrollStepPx: sanitized.scrollStepPx,\n      delayMs: sanitized.delayMs,\n      selectors: didSetCustomSelectors ? selectors : getEffectiveSelectors(undefined),\n      maxScrolls: Number.isFinite(sanitized.maxScrolls) ? sanitized.maxScrolls : null,\n      maxDurationMs: Number.isFinite(sanitized.maxDurationMs) ? sanitized.maxDurationMs : null\n    }\n  };\n}\n", "import { DEFAULT_AD_SELECTORS } from '../measurement/selectors.js';\nimport type {\n  AdScoreConfig,\n  CreateConfigOptions,\n  DeviceProfileConfig,\n  MetricConfig,\n  RuntimeConfigContext\n} from '../types/config.js';\n\nconst VERSION = '0.1.0';\n\nconst BASE_METRICS: AdScoreConfig['metrics'] = {\n  adDensity: {\n    id: 'adDensity',\n    enabled: true,\n    weight: 1,\n    maxScore: 100,\n    thresholds: {\n      ideal: 0.25,\n      caution: 0.55,\n      fail: 0.85\n    }\n  },\n  adCount: {\n    id: 'adCount',\n    enabled: false,\n    weight: 0,\n    maxScore: 0,\n    thresholds: {\n      ideal: 5,\n      caution: 8,\n      fail: 12\n    }\n  },\n  contentDistance: {\n    id: 'contentDistance',\n    enabled: false,\n    weight: 0,\n    maxScore: 0,\n    thresholds: {\n      ideal: 600,\n      caution: 360,\n      fail: 180\n    }\n  },\n  viewportCoverage: {\n    id: 'viewportCoverage',\n    enabled: false,\n    weight: 0,\n    maxScore: 0,\n    thresholds: {\n      ideal: 0.3,\n      caution: 0.45,\n      fail: 0.7\n    }\n  }\n};\n\nconst BASE_PROFILES: Record<'desktop' | 'mobile', DeviceProfileConfig> = {\n  desktop: {\n    id: 'desktop',\n    label: 'Desktop default',\n    scroll: {\n      delayMs: 1500,\n      maxScrolls: 16,\n      maxDurationMs: 120_000\n    },\n    metricWeights: {\n      adDensity: 1\n    }\n  },\n  mobile: {\n    id: 'mobile',\n    label: 'Mobile default',\n    scroll: {\n      delayMs: 1000,\n      maxScrolls: 20,\n      maxDurationMs: 140_000\n    },\n    metricWeights: {\n      adDensity: 1\n    }\n  }\n};\n\nfunction cloneMetric(metric: MetricConfig): MetricConfig {\n  return {\n    ...metric,\n    thresholds: { ...metric.thresholds }\n  };\n}\n\nfunction deepMergeMetric(base: MetricConfig, override: Partial<MetricConfig>): MetricConfig {\n  const merged = { ...base, ...override };\n  if (override.thresholds) {\n    merged.thresholds = {\n      ...base.thresholds,\n      ...override.thresholds\n    };\n  }\n  return merged;\n}\n\nfunction deepMergeProfile(base: DeviceProfileConfig, override: Partial<DeviceProfileConfig>): DeviceProfileConfig {\n  return {\n    ...base,\n    ...override,\n    scroll: {\n      ...base.scroll,\n      ...override.scroll\n    },\n    metricWeights: {\n      ...base.metricWeights,\n      ...override.metricWeights\n    }\n  };\n}\n\nexport function createConfig(options: CreateConfigOptions = {}): RuntimeConfigContext {\n  const { overrides, profileId } = options;\n\n  const metrics: AdScoreConfig['metrics'] = {\n    adDensity: cloneMetric(BASE_METRICS.adDensity),\n    adCount: cloneMetric(BASE_METRICS.adCount),\n    contentDistance: cloneMetric(BASE_METRICS.contentDistance),\n    viewportCoverage: cloneMetric(BASE_METRICS.viewportCoverage)\n  };\n\n  if (overrides?.metrics) {\n    for (const key of Object.keys(overrides.metrics) as Array<keyof typeof metrics>) {\n      const overrideConfig = overrides.metrics[key];\n      if (!overrideConfig) continue;\n      metrics[key] = deepMergeMetric(metrics[key], overrideConfig);\n    }\n  }\n\n  const profiles: AdScoreConfig['profiles'] = {\n    desktop: { ...BASE_PROFILES.desktop, scroll: { ...BASE_PROFILES.desktop.scroll }, metricWeights: { ...BASE_PROFILES.desktop.metricWeights } },\n    mobile: { ...BASE_PROFILES.mobile, scroll: { ...BASE_PROFILES.mobile.scroll }, metricWeights: { ...BASE_PROFILES.mobile.metricWeights } }\n  };\n\n  if (overrides?.profiles) {\n    for (const key of Object.keys(overrides.profiles) as Array<'desktop' | 'mobile'>) {\n      const overrideProfile = overrides.profiles[key];\n      if (!overrideProfile) continue;\n      profiles[key] = deepMergeProfile(profiles[key], overrideProfile);\n    }\n  }\n\n  const selectors = overrides?.selectors?.length ? overrides.selectors : [...DEFAULT_AD_SELECTORS];\n  const defaultProfile = overrides?.defaultProfile ?? 'desktop';\n  const selectedProfileId = profileId ?? defaultProfile;\n  const profile = profiles[selectedProfileId];\n\n  const config: AdScoreConfig = {\n    version: VERSION,\n    selectors,\n    metrics,\n    profiles,\n    defaultProfile\n  };\n\n  return {\n    config,\n    profile\n  };\n}\n", "import type { MetricComputationContext, MetricComputationResult } from '../types/metrics.js';\nimport type { AdSlotSample } from '../types/measurement.js';\n\nfunction clampScore(value: number, min: number, max: number): number {\n  return Math.max(min, Math.min(max, value));\n}\n\nfunction calculateLinearScore(raw: number, ideal: number, fail: number, maxScore: number): number {\n  if (fail === ideal) {\n    return raw <= ideal ? maxScore : 0;\n  }\n\n  if (raw <= ideal) {\n    return maxScore;\n  }\n\n  if (raw >= fail) {\n    return 0;\n  }\n\n  const ratio = (raw - ideal) / (fail - ideal);\n  return clampScore(maxScore * (1 - ratio), 0, maxScore);\n}\n\nfunction deriveSlotKey(slot: AdSlotSample): string {\n  const dataset = slot.dataset;\n  const candidates = [\n    dataset.googleQueryId,\n    dataset.googleAdId,\n    dataset.adSlot,\n    dataset.adUnit,\n    dataset.googleContainerId,\n    dataset.adnmSid,\n    dataset.adnmFid,\n    dataset.adnmChannel,\n    dataset.adsCoreId,\n    slot.slotName,\n    slot.logicalId,\n    slot.id\n  ];\n\n  const key = candidates.find(value => typeof value === 'string' && value.trim().length > 0);\n  return key ?? slot.id;\n}\n\nfunction isStickySlot(slot: AdSlotSample): boolean {\n  if (slot.isSticky) {\n    return true;\n  }\n\n  const dataset = slot.dataset;\n  const manualPlacement = dataset.manualPlacementGroup ?? dataset.adPositionName ?? '';\n  if (manualPlacement.toLowerCase().includes('sticky')) {\n    return true;\n  }\n\n  const fid = dataset.adnmFid ?? '';\n  if (fid) {\n    const lower = fid.toLowerCase();\n    if (lower.includes('skin') || lower.includes('topscroll') || lower.includes('canvas')) {\n      return true;\n    }\n  }\n\n  const slotName = slot.slotName ?? '';\n  if (slotName.toLowerCase().includes('sticky')) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function computeAdDensity(context: MetricComputationContext): MetricComputationResult {\n  const { config, run } = context;\n  const { thresholds } = config;\n\n  let dynamicVisibleAdArea = 0;\n  let totalContentArea = 0;\n  let unclampedVisibleAdArea = 0;\n  let clampedSamples = 0;\n\n  const stickyMaxArea = new Map<string, number>();\n\n  for (const sample of run.samples) {\n    let sampleVisibleArea = 0;\n    let sampleNonStickyArea = 0;\n\n    for (const slot of sample.adSlots) {\n      if (!slot.isVisible || slot.visibleArea <= 0) {\n        continue;\n      }\n\n      const effectiveArea = Math.min(slot.visibleArea, sample.totalContentArea);\n      sampleVisibleArea += effectiveArea;\n\n      if (isStickySlot(slot)) {\n        const key = deriveSlotKey(slot);\n        const current = stickyMaxArea.get(key) ?? 0;\n        if (effectiveArea > current) {\n          stickyMaxArea.set(key, effectiveArea);\n        }\n        continue;\n      }\n\n      sampleNonStickyArea += effectiveArea;\n    }\n\n    unclampedVisibleAdArea += sampleVisibleArea;\n    const clampedNonStickyArea = Math.min(sampleNonStickyArea, sample.totalContentArea);\n    if (clampedNonStickyArea < sampleNonStickyArea) {\n      clampedSamples += 1;\n    }\n\n    dynamicVisibleAdArea += clampedNonStickyArea;\n    totalContentArea += sample.totalContentArea;\n  }\n\n  const stickyTotalArea = Array.from(stickyMaxArea.values()).reduce((sum, area) => sum + area, 0);\n  const totalVisibleAdArea = dynamicVisibleAdArea + stickyTotalArea;\n\n  const density = totalContentArea > 0 ? totalVisibleAdArea / totalContentArea : 0;\n  const rawValue = Number.isFinite(density) ? density : 0;\n  const score = calculateLinearScore(rawValue, thresholds.ideal, thresholds.fail, config.maxScore);\n  const normalizedScore = config.maxScore > 0 ? score / config.maxScore : 0;\n\n  return {\n    id: config.id,\n    rawValue,\n    score,\n    maxScore: config.maxScore,\n    normalizedScore,\n    meta: {\n      sampleCount: run.samples.length,\n      totalVisibleAdArea,\n      unclampedVisibleAdArea,\n      stickyContributionArea: stickyTotalArea,\n      stickySlotCount: stickyMaxArea.size,\n      clampedSamples,\n      totalContentArea,\n      thresholds\n    }\n  };\n}\n", "import { createConfig } from '../config/index.js';\nimport { captureViewportSamples } from '../measurement/scrollHarness.js';\nimport type { AdScoreConfig, DeviceProfileConfig } from '../types/config.js';\nimport type { MeasurementRun, ScrollCaptureOptions } from '../types/measurement.js';\nimport type { MetricComputer } from '../types/metrics.js';\nimport type { AdScoreReport, MetricSummary, RunAdScoreAuditOptions } from '../types/report.js';\nimport { computeAdDensity } from '../metrics/adDensity.js';\n\nconst METRIC_COMPUTERS: Partial<Record<string, MetricComputer>> = {\n  adDensity: computeAdDensity\n};\n\nfunction selectMetricComputer(metricId: string): MetricComputer | null {\n  const computer = METRIC_COMPUTERS[metricId];\n  return computer ?? null;\n}\n\nasync function performMeasurement(\n  selectors: string[],\n  profileScrollOptions: Pick<ScrollCaptureOptions, 'delayMs' | 'scrollStepPx' | 'maxScrolls' | 'maxDurationMs'>,\n  overrides?: ScrollCaptureOptions,\n  debugFlag?: boolean\n): Promise<MeasurementRun> {\n  const merged: ScrollCaptureOptions = {\n    ...profileScrollOptions,\n    selectors,\n    includeStickyDetection: overrides?.includeStickyDetection ?? true,\n    restoreScrollPosition: overrides?.restoreScrollPosition ?? true,\n    respectShadowDom: overrides?.respectShadowDom ?? false\n  };\n\n  if (overrides) {\n    if (typeof overrides.delayMs === 'number') merged.delayMs = overrides.delayMs;\n    if (typeof overrides.scrollStepPx === 'number') merged.scrollStepPx = overrides.scrollStepPx;\n    if (typeof overrides.maxScrolls === 'number') merged.maxScrolls = overrides.maxScrolls;\n    if (typeof overrides.maxDurationMs === 'number') merged.maxDurationMs = overrides.maxDurationMs;\n    if (typeof overrides.includeStickyDetection === 'boolean') {\n      merged.includeStickyDetection = overrides.includeStickyDetection;\n    }\n    if (typeof overrides.restoreScrollPosition === 'boolean') {\n      merged.restoreScrollPosition = overrides.restoreScrollPosition;\n    }\n    if (typeof overrides.respectShadowDom === 'boolean') {\n      merged.respectShadowDom = overrides.respectShadowDom;\n    }\n  }\n\n  const debugValue = typeof debugFlag === 'boolean' ? debugFlag : overrides?.debug;\n  if (typeof debugValue === 'boolean') {\n    merged.debug = debugValue;\n  }\n\n  return captureViewportSamples(merged);\n}\n\nfunction aggregateMetrics(options: {\n  measurement: MeasurementRun;\n  config: AdScoreConfig;\n  profile: DeviceProfileConfig;\n}): MetricSummary[] {\n  const { measurement, config, profile } = options;\n  const summaries: MetricSummary[] = [];\n\n  for (const metricId of Object.keys(config.metrics)) {\n    const metricConfig = config.metrics[metricId as keyof typeof config.metrics];\n    const computer = selectMetricComputer(metricId);\n\n    if (!metricConfig.enabled || !computer) {\n      continue;\n    }\n\n    const weight = profile.metricWeights[metricConfig.id] ?? metricConfig.weight ?? 0;\n    if (weight <= 0 || metricConfig.maxScore <= 0) {\n      continue;\n    }\n\n    const result = computer({\n      config: metricConfig,\n      run: measurement\n    });\n\n    summaries.push({\n      configId: metricConfig.id,\n      weight,\n      weightedScore: result.score * weight,\n      weightedMaxScore: metricConfig.maxScore * weight,\n      result\n    });\n  }\n\n  return summaries;\n}\n\nfunction computeTotals(summaries: MetricSummary[]): { totalWeightedScore: number; totalWeightedMaxScore: number; totalScore: number } {\n  const totalWeightedScore = summaries.reduce((sum, metric) => sum + metric.weightedScore, 0);\n  const totalWeightedMaxScore = summaries.reduce((sum, metric) => sum + metric.weightedMaxScore, 0);\n  const totalScore = totalWeightedMaxScore > 0 ? (totalWeightedScore / totalWeightedMaxScore) * 100 : 0;\n  return {\n    totalWeightedScore,\n    totalWeightedMaxScore,\n    totalScore\n  };\n}\n\nexport async function runAdScoreAudit(options: RunAdScoreAuditOptions = {}): Promise<AdScoreReport> {\n  const {\n    profileId,\n    configOverrides,\n    measurement: measurementOverrides,\n    debug,\n    consoleReport,\n    visualize\n  } = options;\n\n  const createConfigOptions: Parameters<typeof createConfig>[0] = {};\n  if (configOverrides) {\n    createConfigOptions.overrides = configOverrides;\n  }\n  if (profileId) {\n    createConfigOptions.profileId = profileId;\n  }\n\n  const { config, profile } = createConfig(createConfigOptions);\n\n  if (debug) {\n    console.debug('[AdScore] Using profile', profile);\n    console.debug('[AdScore] Config selectors', config.selectors);\n  }\n\n  const measurement = await performMeasurement(config.selectors, profile.scroll, measurementOverrides, debug);\n\n  const summaries = aggregateMetrics({ measurement, config, profile });\n  const totals = computeTotals(summaries);\n\n  const report: AdScoreReport = {\n    timestamp: Date.now(),\n    config,\n    profile,\n    measurement,\n    metrics: summaries,\n    ...totals\n  };\n\n  if (typeof visualize === 'boolean') {\n    try {\n      const overlayModule = await import('../visualization/overlay.js');\n      if (visualize) {\n        const firstSample = report.measurement.samples[0];\n        if (firstSample) {\n          overlayModule.renderAdOverlays(firstSample.adSlots);\n        }\n      } else {\n        overlayModule.clearAdOverlays();\n      }\n    } catch (error) {\n      console.warn('[AdScore] Failed to toggle overlay', error);\n    }\n  }\n\n  if (consoleReport) {\n    try {\n      const { renderConsoleReport } = await import('../reporting/consoleReporter.js');\n      renderConsoleReport(report);\n    } catch (error) {\n      console.warn('[AdScore] Failed to render console report', error);\n    }\n  }\n\n  return report;\n}\n", "import { captureViewportSamples } from './measurement/scrollHarness.js';\nimport { runAdScoreAudit } from './runtime/runAudit.js';\nimport type { AdSlotSample, MeasurementRun, ScrollCaptureOptions, ViewportSample } from './types/measurement.js';\nimport type { AdScoreReport, RunAdScoreAuditOptions } from './types/report.js';\nimport type { ConfigOverrides } from './types/config.js';\nimport { buildReportSummary } from './reporting/summary.js';\n\nconst GLOBAL_KEY = '__AD_SCORE_RUNTIME__';\n\nlet storedConfigOverrides: ConfigOverrides | undefined;\nlet storedMeasurementOverrides: ScrollCaptureOptions | undefined;\nlet lastReport: AdScoreReport | null = null;\nlet defaultVisualize = false;\n\nconst slotCacheKey = (slot: AdSlotSample) => `${slot.provider}::${slot.logicalId}`;\n\nfunction collectUniqueSlots(samples: ViewportSample[]): AdSlotSample[] {\n  const map = new Map<string, AdSlotSample>();\n  for (const sample of samples) {\n    for (const slot of sample.adSlots) {\n      map.set(slotCacheKey(slot), slot);\n    }\n  }\n  return Array.from(map.values());\n}\n\nasync function runMeasurement(options: ScrollCaptureOptions = {}): Promise<MeasurementRun> {\n  return captureViewportSamples(options);\n}\n\nfunction mergeMeasurementOverrides(options?: ScrollCaptureOptions): ScrollCaptureOptions | undefined {\n  if (!storedMeasurementOverrides && !options) {\n    return options;\n  }\n  return {\n    ...storedMeasurementOverrides,\n    ...options\n  };\n}\n\nasync function runAuditWithState(options: RunAdScoreAuditOptions = {}): Promise<AdScoreReport> {\n  const visualizeFlag = options.visualize ?? defaultVisualize;\n  const baseMeasurement = mergeMeasurementOverrides(options.measurement);\n  const measurementWithVisualization = visualizeFlag\n    ? { ...(baseMeasurement ?? {}), visualizeDuringCapture: true }\n    : baseMeasurement;\n\n  const mergedOptions = {\n    ...options,\n    configOverrides: options.configOverrides ?? storedConfigOverrides,\n    measurement: measurementWithVisualization,\n    visualize: visualizeFlag\n  } as RunAdScoreAuditOptions;\n\n  const report = await runAdScoreAudit(mergedOptions);\n  lastReport = report;\n  const overlayModule = await import('./visualization/overlay.js');\n  if (visualizeFlag) {\n    overlayModule.renderAdOverlays(collectUniqueSlots(report.measurement.samples));\n  } else {\n    overlayModule.clearAdOverlays();\n  }\n  return report;\n}\n\nasync function renderOverlayFromLastReport(sampleIndex = 0): Promise<void> {\n  if (!lastReport) {\n    console.warn('[AdScore] No report available. Run runAudit() first.');\n    return;\n  }\n  const overlayModule = await import('./visualization/overlay.js');\n  if (typeof sampleIndex === 'number' && sampleIndex >= 0) {\n    const sample = lastReport.measurement.samples[sampleIndex];\n    if (!sample) {\n      console.warn('[AdScore] Sample index out of range.');\n      return;\n    }\n    overlayModule.renderAdOverlays(sample.adSlots);\n  } else {\n    overlayModule.renderAdOverlays(collectUniqueSlots(lastReport.measurement.samples));\n  }\n}\n\nasync function clearOverlay(): Promise<void> {\n  const overlayModule = await import('./visualization/overlay.js');\n  overlayModule.clearAdOverlays();\n}\n\ntype DevToolsAPI = {\n  runMeasurement: (options?: ScrollCaptureOptions) => Promise<MeasurementRun>;\n  runAudit: (options?: RunAdScoreAuditOptions) => Promise<AdScoreReport>;\n  setConfigOverrides: (overrides?: ConfigOverrides) => void;\n  getConfigOverrides: () => ConfigOverrides | undefined;\n  setMeasurementDefaults: (overrides?: ScrollCaptureOptions) => void;\n  getMeasurementDefaults: () => ScrollCaptureOptions | undefined;\n  getLastReport: () => AdScoreReport | null;\n  getLastSummary: () => ReturnType<typeof buildReportSummary> | null;\n  renderOverlay: (sampleIndex?: number) => Promise<void>;\n  clearOverlay: () => Promise<void>;\n  setDefaultVisualize: (value: boolean) => void;\n  version: string;\n};\n\ndeclare global {\n  interface Window {\n    [GLOBAL_KEY]?: DevToolsAPI;\n    runAdScoreMeasurement?: (options?: ScrollCaptureOptions) => Promise<MeasurementRun>;\n    runAdScoreAudit?: (options?: RunAdScoreAuditOptions) => Promise<AdScoreReport>;\n    adScore?: DevToolsAPI;\n  }\n}\n\nfunction exposeToWindow(api: DevToolsAPI) {\n  if (typeof window === 'undefined') {\n    return;\n  }\n  if (!(GLOBAL_KEY in window)) {\n    Object.defineProperty(window, GLOBAL_KEY, {\n      value: api,\n      configurable: false,\n      enumerable: false,\n      writable: false\n    });\n  }\n  window.runAdScoreMeasurement = api.runMeasurement;\n  window.runAdScoreAudit = api.runAudit;\n  window.adScore = api;\n  if (typeof console !== 'undefined') {\n    console.info('[AdScore] DevTools API exposed:', {\n      measurement: 'window.runAdScoreMeasurement(options)',\n      audit: 'window.runAdScoreAudit(options)',\n      runtime: 'window.adScore'\n    });\n  }\n}\n\nconst api: DevToolsAPI = {\n  runMeasurement,\n  runAudit: runAuditWithState,\n  setConfigOverrides: overrides => {\n    storedConfigOverrides = overrides;\n    console.info('[AdScore] Config overrides updated', overrides);\n  },\n  getConfigOverrides: () => storedConfigOverrides,\n  setMeasurementDefaults: overrides => {\n    storedMeasurementOverrides = overrides;\n    console.info('[AdScore] Measurement defaults updated', overrides);\n  },\n  getMeasurementDefaults: () => storedMeasurementOverrides,\n  getLastReport: () => lastReport,\n  getLastSummary: () => (lastReport ? buildReportSummary(lastReport) : null),\n  renderOverlay: renderOverlayFromLastReport,\n  clearOverlay,\n  setDefaultVisualize: value => {\n    defaultVisualize = value;\n    console.info('[AdScore] Default visualize set to', value);\n  },\n  version: '0.1.0'\n};\n\nexposeToWindow(api);\n\nexport { runMeasurement, captureViewportSamples, runAdScoreAudit };\n"],
  "mappings": "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",
  "names": ["renderConsoleReport", "api"]
}
